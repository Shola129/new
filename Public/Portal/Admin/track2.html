<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Fee Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #2c3e50, #4a6ee0);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .form-section {
            padding: 30px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .form-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        label:before {
            content: "‚Ü≥";
            color: #4a6ee0;
            font-weight: bold;
        }
        
        select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232c3e50' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 18px center;
            background-size: 18px;
            appearance: none;
        }
        
        select:focus {
            outline: none;
            border-color: #4a6ee0;
            box-shadow: 0 0 0 3px rgba(74, 110, 224, 0.2);
        }
        
        select:hover {
            border-color: #6c757d;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        
        .submit-btn {
            padding: 14px 40px;
            background: linear-gradient(to right, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .submit-btn:before {
            content: "üìä";
            font-size: 1.2rem;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
            background: linear-gradient(to right, #218838, #1ca87e);
        }
        
        .submit-btn:active {
            transform: translateY(-1px);
        }
        
        .submit-btn:disabled {
            background: linear-gradient(to right, #6c757d, #adb5bd);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .submit-btn:disabled:hover {
            transform: none;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
        }
        
        .table-section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            padding: 30px;
            min-height: 600px;
        }
        
        .table-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: fadeIn 0.5s ease forwards;
        }
        
        .selected-info {
            background: linear-gradient(to right, #e8f4fc, #f0f8ff);
            padding: 20px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #4a6ee0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .selected-text {
            font-size: 1.3rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .selected-details {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .selected-item {
            background-color: white;
            padding: 8px 18px;
            border-radius: 6px;
            font-weight: 500;
            color: #4a6ee0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .selected-item:before {
            content: "‚úì";
            color: #28a745;
            font-weight: bold;
        }
        
        .table-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4a6ee0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .table-title span {
            font-size: 1rem;
            color: #6c757d;
            font-weight: normal;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        
        thead {
             background-color: #2c3e50;
            color: white;
        }
        
        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
            position: sticky;
            top: 0;
        }
        
        th:first-child {
            border-radius: 10px 0 0 0;
        }
        
        th:last-child {
            border-radius: 0 10px 0 0;
        }
        
        tbody tr {
            border-bottom: 1px solid #e9ecef;
            transition: all 0.2s ease;
        }
        
        tbody tr:hover {
            background-color: #f8f9fa;
            transform: scale(1.002);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tbody tr:nth-child(even):hover {
            background-color: #f1f3f4;
        }
        
        td {
            padding: 16px 15px;
            color: #495057;
        }
        
        .sn-cell {
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
            width: 60px;
        }
        
        .name-cell {
            font-weight: 600;
            color: #2c3e50;
            min-width: 180px;
        }
        
        .class-cell {
            font-weight: 500;
            color: #495057;
            text-align: center;
            width: 100px;
        }
        
        .admission-cell {
            font-weight: 500;
            color: #6c757d;
            font-family: monospace;
            letter-spacing: 1px;
            width: 140px;
        }
        
        .parent-phone-cell {
            font-weight: 500;
            color: #495057;
            width: 150px;
            font-family: monospace;
        }
        
        .phone-link {
            color: #4a6ee0;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .phone-link:hover {
            text-decoration: underline;
            color: #2c3e50;
        }
        
        .phone-link:before {
            content: "üì±";
            font-size: 0.9rem;
        }
        
        .amount-cell {
            font-weight: 700;
            color: #2c3e50;
            text-align: right;
            width: 110px;
        }
        
        .paid-cell {
            font-weight: 700;
            color: #28a745;
            text-align: right;
            width: 110px;
        }
        
        .balance-cell {
            font-weight: 700;
            text-align: right;
            width: 110px;
        }
        
        .balance-positive {
            color: #28a745;
        }
        
        .balance-negative {
            color: #dc3545;
        }
        
        .balance-zero {
            color: #6c757d;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-paid {
            background-color: #28a745;
        }
        
        .status-partial {
            background-color: #ffc107;
        }
        
        .status-unpaid {
            background-color: #dc3545;
        }
        
        .summary-box {
            background: linear-gradient(to right, #e8f4fc, #f0f8ff);
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 5px solid #4a6ee0;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .summary-item {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 1rem;
            color: #6c757d;
            font-weight: 500;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4a6ee0;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .no-data {
            display: none;
            text-align: center;
            padding: 60px;
            color: #7f8c8d;
            font-size: 1.2rem;
            background-color: #f9fafd;
            border-radius: 10px;
            border: 2px dashed #d1d9e6;
        }
        
        .no-data.active {
            display: block;
        }
        
        .instructions {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            font-size: 1rem;
            line-height: 1.6;
            color: #495057;
            border-left: 5px solid #4a6ee0;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .instructions strong {
            color: #4a6ee0;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
            border-top: 1px solid #dee2e6;
            background-color: #f8f9fa;
        }
        
        .print-btn {
            background: linear-gradient(to right, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0 auto;
        }
        
        .print-btn:before {
            content: "üñ®Ô∏è";
        }
        
        .print-btn:hover {
            background: linear-gradient(to right, #138496, #117a8b);
            transform: translateY(-2px);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .reset-btn {
            background: linear-gradient(to right, #6c757d, #495057);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .reset-btn:before {
            content: "üîÑ";
        }
        
        .reset-btn:hover {
            background: linear-gradient(to right, #495057, #343a40);
            transform: translateY(-2px);
        }
        
        .send-sms-btn {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .send-sms-btn:before {
            content: "üí¨";
        }
        
        .send-sms-btn:hover {
            background: linear-gradient(to right, #8e44ad, #7d3c98);
            transform: translateY(-2px);
        }
        
        .send-sms-btn:disabled {
            background: linear-gradient(to right, #bdc3c7, #95a5a6);
            cursor: not-allowed;
            transform: none;
        }
        
        .send-sms-btn:disabled:hover {
            transform: none;
        }
        
        .sms-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .sms-modal.active {
            display: flex;
        }
        
        .sms-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .sms-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .sms-modal-title {
            font-size: 1.5rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6c757d;
            cursor: pointer;
            padding: 5px;
        }
        
        .close-modal:hover {
            color: #dc3545;
        }
        
        .sms-form-group {
            margin-bottom: 20px;
        }
        
        .sms-form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
        }
        
        .sms-form-group select,
        .sms-form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        .sms-form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .sms-form-group select:focus,
        .sms-form-group textarea:focus {
            outline: none;
            border-color: #4a6ee0;
            box-shadow: 0 0 0 3px rgba(74, 110, 224, 0.2);
        }
        
        .sms-recipient-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4a6ee0;
        }
        
        .sms-recipient-info p {
            margin-bottom: 5px;
            color: #495057;
        }
        
        .sms-recipient-info strong {
            color: #2c3e50;
        }
        
        .sms-preview {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px dashed #ced4da;
        }
        
        .sms-preview-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
        }
        
        .sms-preview-content {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .sms-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        
        .sms-cancel-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .sms-cancel-btn:hover {
            background-color: #5a6268;
        }
        
        .sms-send-btn {
            background: linear-gradient(to right, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .sms-send-btn:hover {
            background: linear-gradient(to right, #218838, #1ca87e);
        }
        
        .sms-success {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .sms-success.active {
            display: block;
        }
        
        .sms-success-icon {
            font-size: 4rem;
            color: #28a745;
            margin-bottom: 20px;
        }
        
        .sms-success-message {
            font-size: 1.2rem;
            color: #495057;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .form-container {
                grid-template-columns: 1fr;
            }
            
            .selected-info {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .selected-details {
                width: 100%;
            }
            
            .table-title {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .summary-box {
                flex-direction: column;
                align-items: center;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .sms-actions {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            th, td {
                padding: 14px 10px;
                font-size: 0.9rem;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Student Fee Management System</h1>
            <!-- <p class="subtitle">Select class, session, and term to view student fee records with parent contact information.</p> -->
        </header>
        
        <div class="form-section">
            <div class="form-container">
                <div class="input-group">
                    <label for="class-select">Select Class</label>
                    <select id="class-select" name="class" required>
                        <option value="" disabled selected>Select Class</option>
                        <option value="SS3-Science">SS3-Science</option>
                        <option value="SS3-Commercial">SS3-Commercial</option>
                        <option value="SS3-ART">SS3-ART</option>
                        <option value="SS2-Science">SS2-Science</option>
                        <option value="SS2-Commercial">SS2-Commercial</option>
                        <option value="SS2-ART">SS2-ART</option>
                        <option value="SS1-Science">SS1-Science</option>
                        <option value="SS1-Commercial">SS1-Commercial</option>
                        <option value="SS1-ART">SS1-ART</option>
                        <option value="JSS3">JSS3</option>
                        <option value="JSS2">JSS2</option>
                        <option value="JSS1">JSS1</option>
                        <option value="PRY5">PRY5</option>
                        <option value="PRY4">PRY4</option>
                        <option value="PRY3">PRY3</option>
                        <option value="PRY2">PRY2</option>
                        <option value="PRY1">PRY1</option>
                        <option value="NUR2">NUR2</option>
                        <option value="NUR1">NUR1</option>
                        <option value="KG1">KG1</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="session-select">Select Session</label>
                    <select id="session-select" name="session" required>
                        <option value="" disabled selected>Select Session</option>
                        <option value="2025/2026">2025/2026 Academic Session</option>
                        <option value="2026/2027">2026/2027 Academic Session</option>
                        <option value="2027/2028">2027/2028 Academic Session</option>
                        <option value="2028/2029">2028/2029 Academic Session</option>
                        <option value="2029/2030">2029/2030 Academic Session</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="term-select">Select Term</label>
                    <select id="term-select" name="term" required>
                        <option value="" disabled selected>Select Term</option>
                        <option value="first">First Term</option>
                        <option value="second">Second Term</option>
                        <option value="third">Third Term</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button id="generate-report" class="submit-btn" onclick="submit()">Generate Fee Report</button>
                </div>
            </div>
        </div>

        <!-- Table section -->
        <div class="table-section" id="table-section">
            <div class="selected-info">
                <div class="selected-text" id="selected-text">Student Fee Report</div>
                <div class="selected-details">
                    <div class="selected-item" id="selected-class">-</div>
                    <div class="selected-item" id="selected-session">-</div>
                    <div class="selected-item" id="selected-term">-</div>
                </div>
            </div>

            <div class="table-title">
                Student Fee Records
                <span id="table-summary">Select class, session, and term to view records</span>
            </div>
            
            <!-- No data message -->
            <div class="no-data" id="no-data">
                
                <!-- <h3>No Student Data Available</h3> -->
                <!-- <p>No fee records found for the selected criteria.</p>
                <p>Please try different class, session, or term selections.</p> -->
            </div>
            
            <!-- Loading indicator -->
             <div class="loading" id="loading">
                <div class="loader"></div>
                <p>Loading fee data...</p>
            </div>
            
            <!-- Table container -->
            <div class="table-container" id="table-container">
                <table id="student-table">
                    <thead>
                        <tr>
                            <th>S/N</th>
                            <th>Student Name</th>
                            <th>Class</th>
                            <th>Admission No.</th>
                            <th>Parent Phone</th>
                            <th>Amount Due</th>
                            <th>Amount Paid</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Table rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Summary section -->
           <div class="summary-box" id="summary-box">
                <div class="summary-item">
                    <div class="summary-value" id="total-due">‚Ç¶0</div>
                    <div class="summary-label">Total Amount Due</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="total-paid">‚Ç¶0</div>
                    <div class="summary-label">Total Amount Paid</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="total-balance">‚Ç¶0</div>
                    <div class="summary-label">Total Balance</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="student-count">0</div>
                    <div class="summary-label">Students in Class</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="fully-paid">0</div>
                    <div class="summary-label">Fully Paid</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="partial-payment">0</div>
                    <div class="summary-label">Partial Payment</div>
                </div>
            </div>
            
            <!-- Action buttons -->
            <div class="action-buttons">
                <!-- <button class="print-btn" onclick="printReport()">Print Report</button>
                <button class="send-sms-btn" id="send-sms-btn" onclick="openSMSModal()" disabled>Send SMS Alert</button> -->
                <button class="reset-btn" onclick="resetForm()">Reset Form</button>
            </div>
        </div>
        
        <!-- SMS Modal -->
        <!-- <div class="sms-modal" id="sms-modal">
            <div class="sms-modal-content">
                <div class="sms-modal-header">
                    <div class="sms-modal-title">Send SMS Alert to Parents</div>
                    <button class="close-modal" onclick="closeSMSModal()">√ó</button>
                </div>
                
                <div id="sms-form">
                    <div class="sms-recipient-info">
                        <p><strong>Recipients:</strong> <span id="sms-recipient-count">0</span> parents with outstanding balances</p>
                        <p><strong>Total Outstanding:</strong> <span id="sms-total-balance">‚Ç¶0</span></p>
                    </div>
                    
                    <div class="sms-form-group">
                        <label for="sms-recipient-type">Send to:</label>
                        <select id="sms-recipient-type">
                            <option value="all">All parents in selected class</option>
                            <option value="unpaid">Parents with unpaid fees only</option>
                            <option value="partial">Parents with partial payments only</option>
                            <option value="custom">Custom selection</option>
                        </select>
                    </div>
                    
                    <div class="sms-form-group">
                        <label for="sms-message">Message Template:</label>
                        <select id="sms-template">
                            <option value="fee-reminder">Fee Payment Reminder</option>
                            <option value="balance-due">Outstanding Balance Notice</option>
                            <option value="partial-payment">Partial Payment Reminder</option>
                            <option value="custom-message">Custom Message</option>
                        </select>
                    </div>
                    
                    <div class="sms-form-group">
                        <label for="sms-message">Message:</label>
                        <textarea id="sms-message" placeholder="Type your message here..."></textarea>
                    </div>
                    
                    <div class="sms-preview">
                        <div class="sms-preview-title">Message Preview:</div>
                        <div class="sms-preview-content" id="sms-preview">
                            Dear Parent,
                            
                            This is a reminder about the outstanding school fees for [Student Name].
                            
                            Total Fee: [Amount]
                            Amount Paid: [Paid]
                            Balance Due: [Balance]
                            
                            Please make payment before the deadline.
                            
                            Thank you,
                            School Administration
                        </div>
                    </div>
                    
                    <div class="sms-actions">
                        <button class="sms-cancel-btn" onclick="closeSMSModal()">Cancel</button>
                        <button class="sms-send-btn" onclick="sendSMS()">Send SMS</button>
                    </div>
                </div>
                
                <div class="sms-success" id="sms-success">
                    <div class="sms-success-icon">‚úÖ</div>
                    <div class="sms-success-message">SMS alerts sent successfully!</div>
                    <button class="sms-cancel-btn" onclick="closeSMSModal()">Close</button>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>How to Use This System</h3>
            <ul>
                <li><strong>Select Class:</strong> Choose the class/grade level you want to view fee records for</li>
                <li><strong>Select Session:</strong> Choose the academic session (e.g., 2023/2024)</li>
                <li><strong>Select Term:</strong> Choose the academic term (First, Second, or Third)</li>
                <li><strong>Generate Report:</strong> Click the "Generate Fee Report" button to display the student fee table</li>
                <li><strong>Table Columns:</strong> S/N (Serial Number), Name, Class, Admission Number, Parent Phone, Amount (Total Due), Paid (Amount Paid), Balance (Remaining Amount)</li>
                <li><strong>Parent Phone:</strong> Click phone numbers to call or use the "Send SMS Alert" button to send fee reminders</li>
                <li><strong>Status Indicators:</strong> Green dot = Fully Paid, Yellow dot = Partial Payment, Red dot = Unpaid</li>
                <li><strong>Print Report:</strong> Use the Print Report button to generate a printable version</li>
                <li><strong>Send SMS:</strong> Send fee reminders to parents with outstanding balances</li>
                <li><strong>Reset Form:</strong> Use the Reset Form button to clear selections and start over</li>
            </ul>
        </div>
         -->
        <div class="footer">
            <p>Student Fee Management System | Version 2.2 | ¬© 2023 School Administration</p>
        </div>
    </div>

    <script>
        async function submit() {
            const classes = document.getElementById("class-select").value;
            const term = document.getElementById('term-select').value;
            const session = document.getElementById('session-select').value;

            if (!classes || !term || !session) {
                alert("Please select class, term, and session");
                return;
            }
            
            try {
                // Show loading and hide other elements
                document.getElementById("loading").classList.add("active");
                document.getElementById("table-section").classList.add("active");
                // document.getElementById("table-container").style.display = "none";
                document.getElementById("no-data").classList.remove("active");
                document.getElementById("summary-box").style.display = "none";
                
                // Update selected info display
                document.getElementById("selected-class").textContent = classes;
                document.getElementById("selected-session").textContent = session;
                document.getElementById("selected-term").textContent = term;
                
                // Get fixed amount for the class category
                const fixedAmount = await getAmountSet(classes, session, term);
                
                if (fixedAmount === null || fixedAmount === 0) {
                    document.getElementById("loading").classList.remove("active");
                    document.getElementById("no-data").classList.add("active");
                    document.getElementById("summary-box").style.display = "none";
                    return;
                }
                
                // Get student info for the selected class
                const e = { classes: classes };
                const api = await fetch('/transaction-record-admin', {
                    method: 'POST',
                    headers: { 'Content-type': 'application/json' },
                    body: JSON.stringify(e)
                });
                
                if (!api.ok) {
                    if (api.status === 404) {
                        document.getElementById("loading").classList.remove("active");
                        document.getElementById("no-data").classList.add("active");
                        document.getElementById("summary-box").style.display = "none";
                        document.getElementById("no-data").textContent="No student record found";
                        return;
                    }
                    throw new Error(`HTTP error! status: ${api.status}`);
                }
                
                const response = await api.json();
                const convert = JSON.parse(response);
                
                if (!convert || convert.length === 0) {
                    document.getElementById("loading").classList.remove("active");
                    document.getElementById("no-data").classList.add("active");
                    document.getElementById("summary-box").style.display = "none";
                    return;
                }
                
                let output = '';
                let totalDue = 0;
                let totalPaid = 0;
                let totalBalance = 0;
                let studentCount = convert.length;
                let fullyPaidCount = 0;
                let partialPaidCount = 0;
                let unpaidCount = 0;
                
                // Process each student
                for (let i = 0; i < convert.length; i++) {
                    const student = convert[i];
                    
                    // Get transaction amount for this student
                    const paidAmount = await getTransaction(student.admission_number, session, term);
                    const balance = fixedAmount - paidAmount;
                    
                    // Update summary totals
                    totalDue += fixedAmount;
                    totalPaid += paidAmount;
                    totalBalance += balance;
                    
                    // Update status counts
                    if (paidAmount >= fixedAmount) {
                        fullyPaidCount++;
                    } else if (paidAmount > 0) {
                        partialPaidCount++;
                    } else {
                        unpaidCount++;
                    }
                    
                    // Format balance display with CSS class
                    let balanceClass = '';
                    let balanceText = '';
                    if (balance === 0) {
                        balanceClass = 'balance-zero';
                        balanceText = '‚Ç¶0';
                    } else if (balance > 0) {
                        balanceClass = 'balance-negative';
                        balanceText = `‚Ç¶${balance.toLocaleString('en-NG', {minimumFractionDigits: 2})}`;
                    } else {
                        balanceClass = 'balance-positive';
                        balanceText = `-‚Ç¶${Math.abs(balance).toLocaleString('en-NG', {minimumFractionDigits: 2})}`;
                    }
                    
                    // Add status indicator
                    let statusIndicator = '';
                    if (paidAmount >= fixedAmount) {
                        statusIndicator = '<span class="status-indicator status-paid"></span>';
                    } else if (paidAmount > 0) {
                        statusIndicator = '<span class="status-indicator status-partial"></span>';
                    } else {
                        statusIndicator = '<span class="status-indicator status-unpaid"></span>';
                    }
                    
                    output += `
                        <tr>
                            <td class="sn-cell">${i + 1}</td>
                            <td class="name-cell">${statusIndicator}${student.name}</td>
                            <td class="class-cell">${student.current_class}</td>
                            <td class="admission-cell">${student.admission_number}</td>
                            <td class="parent-phone-cell">
                                    ${student.guardian_phone}
                            </td>
                            <td class="amount-cell">‚Ç¶${fixedAmount.toLocaleString('en-NG', {minimumFractionDigits: 2})}</td>
                            <td class="paid-cell">‚Ç¶${paidAmount.toLocaleString('en-NG', {minimumFractionDigits: 2})}</td>
                            <td class="balance-cell ${balanceClass}">${balanceText}</td>     
                        </tr>`;
                }
                
                // Hide loading and show results
                document.getElementById("loading").classList.remove("active");
                document.getElementById("table-container").style.display = "flex";
                document.getElementById("table-body").innerHTML = output;
                document.getElementById("no-data").classList.remove("active");
                document.getElementById("summary-box").style.display = "flex";
                
                // Update summary
                document.getElementById("total-due").textContent = `‚Ç¶${totalDue.toLocaleString('en-NG', {minimumFractionDigits: 2})}`;
                document.getElementById("total-paid").textContent = `‚Ç¶${totalPaid.toLocaleString('en-NG', {minimumFractionDigits: 2})}`;
                document.getElementById("total-balance").textContent = `‚Ç¶${totalBalance.toLocaleString('en-NG', {minimumFractionDigits: 2})}`;
                document.getElementById("student-count").textContent = studentCount;
                document.getElementById("fully-paid").textContent = fullyPaidCount;
                document.getElementById("partial-payment").textContent = partialPaidCount;
                
                // Update table summary text
                document.getElementById("table-summary").textContent = 
                    `${studentCount} students, ‚Ç¶${totalBalance.toLocaleString('en-NG', {minimumFractionDigits: 2})} total balance`;
                
                // // Enable SMS button if there are outstanding balances
                // if (totalBalance > 0 && unpaidCount > 0) {
                //     document.getElementById("send-sms-btn").disabled = false;
                // } else {
                //     document.getElementById("send-sms-btn").disabled = true;
                // }
                
            } catch (err) {
                console.error('Error:', err);
                document.getElementById("loading").classList.remove("active");
                document.getElementById("no-data").classList.add("active");
                alert('An error occurred. Please check the console for details.');
            }
        }

        async function getAmountSet(classes, session, term) {
            // Correct mapping based on your HTML options
            let category = '';
            
            if (classes.includes('SS') && classes.includes('Science')) {
                category = 'SS-Science';
            }
             else if (classes.includes('SS') && classes.includes('Commercial')) {
                category = 'SS-Commercial';
            } 
            else if (classes.includes('SS') && classes.includes('ART')) {
                category = 'SS-ART';
            } 
            else if (classes.startsWith('JSS')) {
                category = 'JSS';
            } 
            else if (classes === 'PRY5' || classes === 'PRY4' || classes === 'PRY3') {
                category = 'PRY3-5';
            } 
            else if (classes === 'PRY2' || classes === 'PRY1') {
                category = 'PRY1-2';
            } 
            else if (classes === 'NUR2' || classes === 'NUR1') {
                category = 'NUR1-2';
            } 
            else if (classes === 'KG1') {
                category = 'KG';
            }
            
            try {
                const e = { classes: category, session: session, term: term };
                const api = await fetch('/fixed-amount-particular-class-term-session', {
                    method: 'POST',
                    headers: { 'Content-type': 'application/json' },
                    body: JSON.stringify(e)
                });
                
                if (!api.ok) {
                    if (api.status === 400) {
                        alert('All fields are required');
                        return null;
                    }
                    if (api.status === 404) {
                        console.log('No fixed amount found for this class');
                        document.getElementById("no-data").innerHTML="No fixed payment made for class, term, and session";
                        return null;
                    }
                    throw new Error(`HTTP error! status: ${api.status}`);
                }
                
                const response = await api.json();
                const convert = JSON.parse(response);
                
                let totalFixedAmount = 0;
                
                // Handle both array and object responses
                if (Array.isArray(convert)) {
                    for (let i = 0; i < convert.length; i++) {
                        totalFixedAmount += parseFloat(convert[i].fees_value) || 0;
                    }
                } else if (convert && typeof convert === 'object') {
                    totalFixedAmount = parseFloat(convert.fees_value) || 0;
                }
                
                return totalFixedAmount;
            } catch (err) {
                console.error('Error fetching fixed amount:', err);
                return null;
            }
        }

        async function getTransaction(admission_number, session, term) {
            try {
                const e = { admission_number: admission_number, session: session, term: term };
                const api = await fetch('/get-transaction', { // Update with your actual endpoint
                    method: 'POST',
                    headers: { 'Content-type':'application/json' },
                    body: JSON.stringify(e)
                });
                
                if (!api.ok) {
                    // If no transactions found, return 0
                    return 0;
                }
                
                const response = await api.json();
                const convert = JSON.parse(response);
                
                let totalPaid = 0;
                if (Array.isArray(convert)) {
                    for (let i = 0; i < convert.length; i++) {
                        totalPaid += parseFloat(convert[i].amount) || 0;
                    }
                } else if (convert && typeof convert === 'object') {
                    totalPaid = parseFloat(convert.amount) || 0;
                }
                
                return totalPaid;
            } catch (err) {
                console.error('Error fetching transaction:', err);
                return 0;
            }
        }

        function printReport() {
            window.print();
        }

        function resetForm() {
            document.getElementById("class-select").value = "";
            document.getElementById("session-select").value = "";
            document.getElementById("term-select").value = "";
            document.getElementById("table-section").classList.remove("active");
            document.getElementById("table-container").style.display = "none";
            document.getElementById("no-data").classList.remove("active");
            document.getElementById("summary-box").style.display = "none";
            document.getElementById("send-sms-btn").disabled = true;
        }

        function openSMSModal() {
            document.getElementById("sms-modal").classList.add("active");
        }

        function closeSMSModal() {
            document.getElementById("sms-modal").classList.remove("active");
        }

        function sendSMS() {
            // Implement SMS sending logic here
            document.getElementById("sms-form").style.display = "none";
            document.getElementById("sms-success").classList.add("active");
        }
    </script>
</body>
</html>